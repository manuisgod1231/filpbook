<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web PDF Flipbook</title>
<style>
body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin:0; background:#f0f0f0; }
.flipbook { width: 400px; height: 600px; perspective: 1500px; position: relative; margin-top: 20px; }
.page { width: 100%; height: 100%; position: absolute; backface-visibility: hidden; transition: transform 0.8s ease; display: flex; align-items: center; justify-content: center; }
canvas { width: 100%; height: 100%; }
.controls { margin-top: 10px; }
</style>
</head>
<body>

<h1>Upload PDF to Flipbook</h1>
<input type="file" id="file-input" accept="application/pdf">
<div id="result"></div>

<div class="flipbook" id="flipbook"></div>
<div class="controls">
  <button id="prev">Prev</button>
  <button id="next">Next</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.min.js"></script>
<script>
let current = 0, pages = [], pdfDataUrl = '';
const flipbook = document.getElementById('flipbook');
const fileInput = document.getElementById('file-input');
const nextBtn = document.getElementById('next');
const prevBtn = document.getElementById('prev');
const resultDiv = document.getElementById('result');

// Generate random ID
function randomID(length=10){
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let id = '';
  for(let i=0;i<length;i++) id += chars.charAt(Math.floor(Math.random()*chars.length));
  return id;
}

// Load PDF from file
fileInput.addEventListener('change', async (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = async function() {
    pdfDataUrl = reader.result; // store base64
    const pdf = await pdfjsLib.getDocument({data: new Uint8Array(reader.result)}).promise;
    renderPDF(pdf);
  };
  reader.readAsArrayBuffer(file);
});

// Render PDF to flipbook
async function renderPDF(pdf){
  flipbook.innerHTML = '';
  pages = [];
  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:1.5});
    const canvas = document.createElement('canvas');
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;

    const pageDiv = document.createElement('div');
    pageDiv.className='page';
    if(i!==1) pageDiv.style.transform='rotateY(180deg)';
    pageDiv.appendChild(canvas);
    flipbook.appendChild(pageDiv);
    pages.push(pageDiv);
  }
  current=0;
  const id = randomID();
  localStorage.setItem(id, pdfDataUrl); // store PDF locally
  resultDiv.innerHTML = `<p>Flipbook ID: <strong>${id}</strong></p>
  <p>Share URL: <a href="${window.location.href}?id=${id}" target="_blank">${window.location.href}?id=${id}</a></p>`;
}

// Flipbook navigation
nextBtn.addEventListener('click',()=>{if(current<pages.length-1){pages[current].style.transform='rotateY(-180deg)';current++;}});
prevBtn.addEventListener('click',()=>{if(current>0){current--;pages[current].style.transform='rotateY(0deg)';}});

// Load flipbook from URL ?id=...
window.addEventListener('load', async ()=>{
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  if(id){
    const pdfData = localStorage.getItem(id);
    if(pdfData){
      const pdf = await pdfjsLib.getDocument({data:new Uint8Array(await (await fetch(pdfData)).arrayBuffer())}).promise;
      renderPDF(pdf);
    }else{
      resultDiv.innerHTML = 'Flipbook not found in localStorage.';
    }
  }
});
</script>
</body>
</html>
