<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Upload & Play - Web Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,Arial,Helvetica,sans-serif;margin:20px;background:#fafafa;color:#111}
    .card{max-width:900px;margin:0 auto;padding:18px;background:#fff;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    input[type=file]{display:block;margin-bottom:12px}
    button{padding:10px 14px;border-radius:8px;border:0;background:#007bff;color:#fff;cursor:pointer}
    iframe{width:100%;height:70vh;border:1px solid #ddd;margin-top:12px;border-radius:6px}
    .meta{margin-top:8px;color:#555}
  </style>
</head>
<body>
  <div class="card">
    <h2>Upload a Web Game (ZIP with index.html)</h2>
    <p>Prepare a ZIP file containing your game's <code>index.html</code> and assets. After upload you'll get a playable URL and an embedded player (sandboxed).</p>

    <input type="file" id="file" accept=".zip" />
    <button id="upload">Upload ZIP and Play</button>
    <p id="status" class="meta"></p>

    <div id="playerArea"></div>
  </div>

<script>
document.getElementById('upload').addEventListener('click', async () => {
  const f = document.getElementById('file').files[0];
  if (!f) { alert('Select a ZIP file first'); return; }

  const fd = new FormData();
  fd.append('gamezip', f);

  document.getElementById('status').textContent = 'Uploading...';
  document.getElementById('playerArea').innerHTML = '';

  try {
    const res = await fetch('/upload', { method: 'POST', body: fd });
    const json = await res.json();
    if (!res.ok) {
      document.getElementById('status').textContent = 'Error: ' + (json.error || res.statusText);
      return;
    }

    document.getElementById('status').textContent = 'Upload complete â€” launching game...';
    // show iframe in sandbox - allow-scripts so games can run, but disallow top navigation by not including allow-top-navigation
    const iframe = document.createElement('iframe');
    iframe.src = json.playUrl;
    iframe.sandbox = 'allow-scripts allow-forms allow-modals allow-pointer-lock allow-same-origin';
    iframe.loading = 'lazy';
    iframe.referrerPolicy = 'no-referrer';
    document.getElementById('playerArea').appendChild(iframe);

    // show direct link
    const a = document.createElement('p');
    a.innerHTML = `Direct play URL: <a href="${json.playUrl}" target="_blank" rel="noopener">${json.playUrl}</a> (opens in new tab)`;
    document.getElementById('playerArea').appendChild(a);

  } catch (err) {
    console.error(err);
    document.getElementById('status').textContent = 'Upload failed: ' + (err.message || err);
  }
});
</script>
</body>
</html>
